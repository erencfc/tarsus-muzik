generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("MYSQL_DATABASE_URL")
}

model Order {
  id     String      @id @default(uuid()) @map("_id")
  status OrderStatus @default(PENDING)
  items  OrderItem[]

  Coupon   Coupon? @relation(fields: [couponId], references: [id])
  couponId String?

  totalPrice    Float
  totalDiscount Float
  totalShipping Float

  User   User?   @relation(fields: [userId], references: [id])
  userId String?

  address   Address @relation(fields: [addressId], references: [id])
  addressId String

  payment   Payment @relation(fields: [paymentId], references: [id])
  paymentId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orders")
}

enum OrderStatus {
  PENDING
  CANCELLED
  COMPLETED
}

model Payment {
  id        String        @id @default(uuid()) @map("_id")
  method    PaymentMethod
  Order     Order[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@map("payments")
}

enum PaymentMethod {
  CREDIT_CARD
  BANK_TRANSFER
}

model OrderItem {
  id String @id @default(uuid()) @map("_id")

  Product   Product @relation(fields: [productId], references: [id])
  productId String
  quantity  Int

  orderId String
  Order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orderItems")
}

model Cart {
  id        String     @id @default(uuid()) @map("_id")
  items     CartItem[]
  shipping  Int        @default(0)
  discount  Int        @default(0)
  Coupon    Coupon?    @relation(fields: [couponId], references: [id])
  couponId  String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  User      User?      @relation(fields: [userId], references: [id])
  userId    String?

  @@map("carts")
}

model CartItem {
  id        String  @id @default(uuid()) @map("_id")
  productId String
  Product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity  Int
  cartId    String
  Cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@map("cartItems")
}

model Coupon {
  id            String       @id @default(uuid()) @map("_id")
  active        Boolean      @default(true)
  description   String?
  maxUse        Int?
  minPurchase   Int?
  code          String       @unique
  discount      Int
  discountType  DiscountType
  validFrom     DateTime     @default(now())
  validTo       DateTime?
  Category      Category?    @relation(fields: [categoryId], references: [id])
  categoryId    String?
  SubCategory   SubCategory? @relation(fields: [subCategoryId], references: [id])
  subCategoryId String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  Cart          Cart[]
  Order         Order[]

  @@map("coupons")
}

enum DiscountType {
  PERCENT
  FIXED
}

model Product {
  id                 String          @id @default(uuid()) @map("_id")
  Brand              Brand           @relation(fields: [brandId], references: [id], onDelete: Cascade)
  brandId            String
  model              String          @unique
  modelSlug          String          @unique
  images             Json
  price              Int
  discountPrice      Int?
  description        String          @db.Text
  deliveryTimeMinDay Int
  deliveryTimeMaxDay Int
  stock              Int
  stockStatus        Boolean
  active             Boolean         @default(true)
  rating             Int             @default(0)
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  Category           Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId         String
  SubCategory        SubCategory     @relation(fields: [subCategoryId], references: [id], onDelete: Cascade)
  subCategoryId      String
  from               String?         @default("bilinmeyen")
  CartItem           CartItem[]
  Favorite           Favorite[]
  Comment            Comment[]
  DiscountAlert      DiscountAlert[]
  OrderItem          OrderItem[]
  DealerPrice        DealerPrice[]

  @@map("products")
}

model DiscountAlert {
  id           String   @id @default(uuid()) @map("_id")
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String
  Product      Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId    String
  currentPrice Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("discountAlerts")
}

model Comment {
  id        String   @id @default(uuid()) @map("_id")
  title     String?
  content   String?
  rating    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  Product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  @@map("comments")
}

model Category {
  id String @id @default(uuid()) @map("_id")

  order Int     @default(0)
  name  String  @unique
  slug  String  @unique
  color Boolean @default(false)

  SubCategory SubCategory[]
  Product     Product[]
  Coupon      Coupon[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

model SubCategory {
  id String @id @default(uuid()) @map("_id")

  order Int    @default(0)
  name  String @unique
  slug  String @unique

  Category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId String

  Product Product[]
  Coupon  Coupon[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("subCategories")
}

model Brand {
  id        String    @id @default(uuid()) @map("_id")
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Product   Product[]

  @@map("brands")
}

model User {
  id            String          @id @default(uuid()) @map("_id")
  firstName     String
  lastName      String
  Addresses     Address[]
  email         String          @unique
  tel           String          @unique
  password      String
  emailNoti     Boolean         @default(true)
  smsNoti       Boolean         @default(true)
  emailVerified DateTime?
  Favorite      Favorite[]
  Comment       Comment[]
  DiscountAlert DiscountAlert[]
  role          Role            @default(USER)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  Cart          Cart[]
  Order         Order[]
  Dealer        Dealer?

  @@map("users")
}

enum Role {
  ADMIN
  USER
  DEALER
}

model Dealer {
  id String @id @default(uuid()) @map("_id")

  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique

  prices DealerPrice[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dealers")
}

model DealerPrice {
  id String @id @default(uuid()) @map("_id")

  price Int

  Product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  Dealer   Dealer @relation(fields: [dealerId], references: [id], onDelete: Cascade)
  dealerId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([productId, dealerId])
  @@map("dealerPrices")
}

model VerificationToken {
  id        String   @id @default(uuid()) @map("_id")
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
  @@map("verificationTokens")
}

model PasswordResetToken {
  id        String   @id @default(uuid()) @map("_id")
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
  @@map("passwordResetTokens")
}

model Address {
  id String @id @default(uuid()) @map("_id")

  alias         String
  firstName     String
  lastName      String
  tel           String
  city          String
  town          String
  district      String
  details       String
  zipCode       String
  billing       Boolean     @default(false)
  billingType   BillingType
  nationalId    String?
  corporateName String?
  taxOffice     String?
  taxNumber     String?
  isCompany     Boolean     @default(false)

  User   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String
  Order  Order[]

  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, alias])
  @@map("addresses")
}

enum BillingType {
  INDIVIDUAL
  CORPORATE
}

model Favorite {
  id        String   @id @default(uuid()) @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  Product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  @@map("favorites")
}
